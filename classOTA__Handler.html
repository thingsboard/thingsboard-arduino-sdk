<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ThingsBoard Client SDK: OTA_Handler&lt; Logger &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">ThingsBoard Client SDK<span id="projectnumber">&#160;0.15.0</span>
   </div>
   <div id="projectbrief">Client SDK to connect with ThingsBoard IoT Platform from IoT devices (Arduino, Espressif, etc.)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classOTA__Handler-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">OTA_Handler&lt; Logger &gt; Class Template Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Handles the complete processing of received binary firmware data, including flashing it onto the device, creating a hash of the received data and in the end ensuring that the complete OTA firmware was flashes successfully and that the hash is the one we initally received.  
 <a href="classOTA__Handler.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="OTA__Handler_8h_source.html">OTA_Handler.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for OTA_Handler&lt; Logger &gt;:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="classOTA__Handler__inherit__graph.svg" width="220" height="124"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ad1fbd88eb818ecf1d8338f60188ef5e2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOTA__Handler.html#ad1fbd88eb818ecf1d8338f60188ef5e2">OTA_Handler</a> (<a class="el" href="classCallback.html">Callback</a>&lt; bool, size_t const &amp;, size_t const &amp; &gt;::function publish_callback, <a class="el" href="classCallback.html">Callback</a>&lt; bool, <a class="el" href="classchar.html">char</a> const *const, <a class="el" href="classchar.html">char</a> const *const &gt;::function send_fw_state_callback, <a class="el" href="classCallback.html">Callback</a>&lt; bool &gt;::function finish_callback)</td></tr>
<tr class="memdesc:ad1fbd88eb818ecf1d8338f60188ef5e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="classOTA__Handler.html#ad1fbd88eb818ecf1d8338f60188ef5e2">More...</a><br /></td></tr>
<tr class="separator:ad1fbd88eb818ecf1d8338f60188ef5e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b8f4655c8ba07c43de984cd95b1298d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOTA__Handler.html#a2b8f4655c8ba07c43de984cd95b1298d">Start_Firmware_Update</a> (<a class="el" href="classOTA__Update__Callback.html">OTA_Update_Callback</a> const &amp;fw_callback, size_t const &amp;fw_size, <a class="el" href="classchar.html">char</a> const *fw_checksum, <a class="el" href="classmbedtls__md__type__t.html">mbedtls_md_type_t</a> const &amp;fw_checksum_algorithm)</td></tr>
<tr class="memdesc:a2b8f4655c8ba07c43de984cd95b1298d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts the firmware update with requesting the first firmware packet and initalizes the underlying needed components.  <a href="classOTA__Handler.html#a2b8f4655c8ba07c43de984cd95b1298d">More...</a><br /></td></tr>
<tr class="separator:a2b8f4655c8ba07c43de984cd95b1298d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0892bc8581315677ab9e7bae8040b433"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOTA__Handler.html#a0892bc8581315677ab9e7bae8040b433">Stop_Firmware_Update</a> ()</td></tr>
<tr class="memdesc:a0892bc8581315677ab9e7bae8040b433"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops the firmware update completly and informs that user that the update has failed because it has been aborted, ongoing communication is discarded. Be aware the written partition is not erased so the already written binary firmware data still remains in the flash partition, shouldn't really matter, because if we start the update process again the partition will be overwritten anyway and a partially written firmware will not be bootable.  <a href="classOTA__Handler.html#a0892bc8581315677ab9e7bae8040b433">More...</a><br /></td></tr>
<tr class="separator:a0892bc8581315677ab9e7bae8040b433"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e7c822ac13b6aebaf81b447512b0989"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOTA__Handler.html#a5e7c822ac13b6aebaf81b447512b0989">Process_Firmware_Packet</a> (size_t const &amp;current_chunk, <a class="el" href="classuint8__t.html">uint8_t</a> *payload, size_t const &amp;total_bytes)</td></tr>
<tr class="memdesc:a5e7c822ac13b6aebaf81b447512b0989"><td class="mdescLeft">&#160;</td><td class="mdescRight">Uses the given firmware packet data and process it. Starting with writing the given amount of bytes of the packet data into flash memory and into a hash function that will be used to compare the expected complete binary file and the actually received binary file.  <a href="classOTA__Handler.html#a5e7c822ac13b6aebaf81b447512b0989">More...</a><br /></td></tr>
<tr class="separator:a5e7c822ac13b6aebaf81b447512b0989"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af29a3abbf057a684fe0a071cc8af5191"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classOTA__Handler.html#af29a3abbf057a684fe0a071cc8af5191">update</a> ()</td></tr>
<tr class="memdesc:af29a3abbf057a684fe0a071cc8af5191"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to update the watchdog timer which uses a simple software time in the background. Ensure to call recently often for higher precision. Meaning the timer is actually triggered closer to the specified waiting time.  <a href="classOTA__Handler.html#af29a3abbf057a684fe0a071cc8af5191">More...</a><br /></td></tr>
<tr class="separator:af29a3abbf057a684fe0a071cc8af5191"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="compoundTemplParams">template&lt;typename Logger&gt;<br />
class OTA_Handler&lt; Logger &gt;</div><p >Handles the complete processing of received binary firmware data, including flashing it onto the device, creating a hash of the received data and in the end ensuring that the complete OTA firmware was flashes successfully and that the hash is the one we initally received. </p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">Logger</td><td>Implementation that should be used to print error messages generated by internal processes and additional debugging messages if THINGSBOARD_ENABLE_DEBUG is set </td></tr>
  </table>
  </dd>
</dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ad1fbd88eb818ecf1d8338f60188ef5e2" name="ad1fbd88eb818ecf1d8338f60188ef5e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1fbd88eb818ecf1d8338f60188ef5e2">&#9670;&#160;</a></span>OTA_Handler()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Logger &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classOTA__Handler.html">OTA_Handler</a>&lt; Logger &gt;<a class="el" href="classOTA__Handler.html">::OTA_Handler</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCallback.html">Callback</a>&lt; bool, size_t const &amp;, size_t const &amp; &gt;::function&#160;</td>
          <td class="paramname"><em>publish_callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCallback.html">Callback</a>&lt; bool, <a class="el" href="classchar.html">char</a> const *const, <a class="el" href="classchar.html">char</a> const *const &gt;::function&#160;</td>
          <td class="paramname"><em>send_fw_state_callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCallback.html">Callback</a>&lt; bool &gt;::function&#160;</td>
          <td class="paramname"><em>finish_callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">publish_callback</td><td><a class="el" href="classCallback.html" title="General purpose safe callback wrapper. Expects either c-style or c++ style function pointer,...">Callback</a> that is used to request the firmware chunk of the firmware binary with the given chunk number </td></tr>
    <tr><td class="paramname">send_fw_state_callback</td><td><a class="el" href="classCallback.html" title="General purpose safe callback wrapper. Expects either c-style or c++ style function pointer,...">Callback</a> that is used to send information about the current state of the over the air update </td></tr>
    <tr><td class="paramname">finish_callback</td><td><a class="el" href="classCallback.html" title="General purpose safe callback wrapper. Expects either c-style or c++ style function pointer,...">Callback</a> that is called once the update has been finished and the user should be informed of the failure or success of the over the air update </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a5e7c822ac13b6aebaf81b447512b0989" name="a5e7c822ac13b6aebaf81b447512b0989"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e7c822ac13b6aebaf81b447512b0989">&#9670;&#160;</a></span>Process_Firmware_Packet()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Logger &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOTA__Handler.html">OTA_Handler</a>&lt; Logger &gt;::Process_Firmware_Packet </td>
          <td>(</td>
          <td class="paramtype">size_t const &amp;&#160;</td>
          <td class="paramname"><em>current_chunk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classuint8__t.html">uint8_t</a> *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t const &amp;&#160;</td>
          <td class="paramname"><em>total_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Uses the given firmware packet data and process it. Starting with writing the given amount of bytes of the packet data into flash memory and into a hash function that will be used to compare the expected complete binary file and the actually received binary file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_chunk</td><td>Index of the chunk we recieved the binary data for </td></tr>
    <tr><td class="paramname">payload</td><td>Firmware packet data of the current chunk </td></tr>
    <tr><td class="paramname">total_bytes</td><td>Amount of bytes in the current firmware packet data </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a2b8f4655c8ba07c43de984cd95b1298d" name="a2b8f4655c8ba07c43de984cd95b1298d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b8f4655c8ba07c43de984cd95b1298d">&#9670;&#160;</a></span>Start_Firmware_Update()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Logger &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOTA__Handler.html">OTA_Handler</a>&lt; Logger &gt;::Start_Firmware_Update </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classOTA__Update__Callback.html">OTA_Update_Callback</a> const &amp;&#160;</td>
          <td class="paramname"><em>fw_callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t const &amp;&#160;</td>
          <td class="paramname"><em>fw_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classchar.html">char</a> const *&#160;</td>
          <td class="paramname"><em>fw_checksum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmbedtls__md__type__t.html">mbedtls_md_type_t</a> const &amp;&#160;</td>
          <td class="paramname"><em>fw_checksum_algorithm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Starts the firmware update with requesting the first firmware packet and initalizes the underlying needed components. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fw_callback</td><td><a class="el" href="classCallback.html" title="General purpose safe callback wrapper. Expects either c-style or c++ style function pointer,...">Callback</a> method that contains configuration information, about the over the air update </td></tr>
    <tr><td class="paramname">fw_size</td><td>Complete size of the firmware binary that will be downloaded and flashed onto this device </td></tr>
    <tr><td class="paramname">fw_checksum</td><td>Checksum of the complete firmware binary, should be the same as the actually written data in the end </td></tr>
    <tr><td class="paramname">fw_checksum_algorithm</td><td>Algorithm type used to hash the firmware binary </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0892bc8581315677ab9e7bae8040b433" name="a0892bc8581315677ab9e7bae8040b433"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0892bc8581315677ab9e7bae8040b433">&#9670;&#160;</a></span>Stop_Firmware_Update()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Logger &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOTA__Handler.html">OTA_Handler</a>&lt; Logger &gt;::Stop_Firmware_Update </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stops the firmware update completly and informs that user that the update has failed because it has been aborted, ongoing communication is discarded. Be aware the written partition is not erased so the already written binary firmware data still remains in the flash partition, shouldn't really matter, because if we start the update process again the partition will be overwritten anyway and a partially written firmware will not be bootable. </p>

</div>
</div>
<a id="af29a3abbf057a684fe0a071cc8af5191" name="af29a3abbf057a684fe0a071cc8af5191"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af29a3abbf057a684fe0a071cc8af5191">&#9670;&#160;</a></span>update()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Logger &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classOTA__Handler.html">OTA_Handler</a>&lt; Logger &gt;::update </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used to update the watchdog timer which uses a simple software time in the background. Ensure to call recently often for higher precision. Meaning the timer is actually triggered closer to the specified waiting time. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/<a class="el" href="OTA__Handler_8h_source.html">OTA_Handler.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
